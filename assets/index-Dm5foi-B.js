import{R as J,P as j,S as Q,g as A,a as y,s as _,n as Z}from"./tone-B-Z_Kd95.js";import{p as ee}from"./p5-BLJo1RsL.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();const m=50,u=50;function N(){return Array.from({length:u},()=>Array(m).fill(null))}function M(){return"cmc_note_day_"+new Date().toISOString().split("T")[0]}function H(){return!!localStorage.getItem(M())}function te(){localStorage.setItem(M(),"1")}function ne(){localStorage.removeItem(M())}function F(t,e=18,n=12){for(let l=0;l<e;l++){const r=Math.floor(Math.random()*u),o=Math.floor(Math.random()*m);t[r][o]||(t[r][o]={colorIdx:Math.floor(Math.random()*n)})}}function oe(t){let e=0,n=0;for(let l=0;l<m;l++){let r=!1;for(let o=0;o<u;o++)t[o][l]&&(e++,r=!0);r&&n++}return{total:e,activeCols:n}}const g=[{name:"Crimson",hex:"#E63946",temp:"warm",bright:"bright"},{name:"Ember",hex:"#F4722B",temp:"warm",bright:"bright"},{name:"Amber",hex:"#F7B731",temp:"warm",bright:"bright"},{name:"Chartreuse",hex:"#9BC53D",temp:"neutral",bright:"medium"},{name:"Forest",hex:"#2D9E5C",temp:"neutral",bright:"medium"},{name:"Jade",hex:"#40BCD8",temp:"neutral",bright:"bright"},{name:"Cerulean",hex:"#3A7BD5",temp:"cool",bright:"bright"},{name:"Navy",hex:"#1A3A6C",temp:"cool",bright:"dark"},{name:"Indigo",hex:"#6C63FF",temp:"cool",bright:"bright"},{name:"Violet",hex:"#B44FE8",temp:"cool",bright:"bright"},{name:"Rose",hex:"#F472B6",temp:"warm",bright:"bright"},{name:"Pearl",hex:"#D4C9B0",temp:"neutral",bright:"bright"}];function O(t){return{warm:"8n",neutral:"4n",cool:"2n"}[t.temp]}function G(t){return{dark:.28,medium:.62,bright:.92}[t.bright]}const re={warm:"short",neutral:"med",cool:"long"},le={dark:"soft",medium:"med",bright:"loud"},k=["C5","B4","A4","G4","F4","E4","D4","C4","B3","A3","G3","F3","E3","D3","C3"],ae=50;function T(t){const e=Math.floor(t/ae*k.length);return k[Math.min(e,k.length-1)]}function Y(t){const e=[];let n=0,l=0,r=0;const o=a=>{if(l===0)return;let s;l<=2?s=l:l<=5?(s=2,n++):(s=3,n++),e.push({type:"rest",col:r,units:s}),l=0};for(let a=0;a<m;a++){const s=[];for(let d=0;d<u;d++)t[d][a]&&s.push({r:d,colorIdx:t[d][a].colorIdx});if(s.length===0){l===0&&(r=a),l++;continue}o(),s.sort((d,B)=>d.r-B.r);const i=s[Math.floor(s.length/2)],h=g[i.colorIdx];e.push({type:"note",col:a,note:T(i.r),duration:O(h),velocity:G(h),colorHex:h.hex,noteCount:s.length})}return o(),{events:e,compressed:n}}function X(t,e){const n={"8n":.5,"4n":1,"2n":2},l=e/60;let r=0;for(const o of t)o.type==="note"?r+=n[o.duration]??1:r+=o.units*.5;return r/l}const ce=new J({decay:2.5,wet:.35}).toDestination(),W=new j(Q,{oscillator:{type:"triangle"},envelope:{attack:.04,decay:.2,sustain:.5,release:1.2}}).connect(ce);A().volume.value=-10;let D=!1,E=-1;const se=()=>D,ie=()=>E,I={onColChange:()=>{},onStop:()=>{}};function de(t){I.onColChange=t}function ue(t){I.onStop=t}async function me(t,e){await _();const{events:n}=Y(t);if(n.filter(i=>i.type==="note").length===0)return!1;y().cancel(),y().bpm.value=e,D=!0,E=-1;const r={"8n":.5,"4n":1,"2n":2},o=e/60;let a=0;for(const i of n)if(i.type==="note"){const h=a/o,d={...i};y().schedule(B=>{W.triggerAttackRelease(d.note,d.duration,B,d.velocity),E=d.col,I.onColChange(d.col,d.note)},h),a+=r[i.duration]??1}else a+=i.units*.5;const s=X(n,e);return y().schedule(()=>{S()},s+.1),y().start(),!0}function S(){y().stop(),y().cancel(),D=!1,E=-1,I.onStop()}function he(t,e,n){_().then(()=>{W.triggerAttackRelease(t,e,Z(),n)})}function fe(t){y().bpm.value=t}function ge(t){A().volume.value=t}const c=10,v={row:-1,col:-1};let C=null,P=0,V=null;function q(t){C=t}function K(t){P=t}function ye(t){V=t}function ve(t,e){const n=T(t),l=C[t][e],r=document.getElementById("hover-info");if(r.classList.add("active"),l){const o=g[l.colorIdx];r.innerHTML=`<span class="h-note">${n}</span> · ${o.name} · col ${e+1}, row ${t+1} · <em style="color:var(--text-dim)">occupied</em>`}else{const o=g[P];r.innerHTML=`<span class="h-note">${n}</span> · ${o.name} · col ${e+1}, row ${t+1}`}}function $(){const t=document.getElementById("hover-info");t.textContent="Move over the grid to preview a cell",t.classList.remove("active")}function Ce(t){new ee(e=>{e.setup=()=>{e.createCanvas(m*c,u*c).parent(t),e.frameRate(30),e.colorMode(e.RGB,255)},e.draw=()=>{if(!C)return;e.background(10,13,24);const n=ie();e.stroke(25,32,55),e.strokeWeight(.5);for(let o=0;o<=m;o++)e.line(o*c,0,o*c,u*c);for(let o=0;o<=u;o++)e.line(0,o*c,m*c,o*c);e.noStroke();for(let o=0;o<m;o++)if(o!==n){for(let a=0;a<u;a++)if(C[a][o]){e.fill(201,168,76,8),e.rect(o*c,0,c,u*c);break}}for(let o=0;o<u;o++)for(let a=0;a<m;a++){if(!C[o][a])continue;const s=g[C[o][a].colorIdx],i=e.color(s.hex),h=a===n;e.noStroke(),e.fill(e.red(i),e.green(i),e.blue(i),h?255:210),e.rect(a*c+1,o*c+1,c-2,c-2,1),h&&(e.fill(e.red(i),e.green(i),e.blue(i),50),e.rect(a*c,o*c,c,c,1))}n>=0&&(e.stroke(201,168,76,150),e.strokeWeight(1.5),e.line(n*c,0,n*c,u*c),e.line((n+1)*c,0,(n+1)*c,u*c));const{row:l,col:r}=v;if(l>=0&&r>=0&&!C[l][r]){const o=g[P],a=e.color(o.hex);e.noStroke(),e.fill(e.red(a),e.green(a),e.blue(a),55),e.rect(r*c+1,l*c+1,c-2,c-2,1),e.stroke(e.red(a),e.green(a),e.blue(a),35),e.strokeWeight(.5),e.line(0,l*c+c/2,m*c,l*c+c/2)}},e.mouseMoved=()=>{const n=Math.floor(e.mouseX/c),l=Math.floor(e.mouseY/c);n>=0&&n<m&&l>=0&&l<u?(v.row=l,v.col=n,ve(l,n)):(v.row=-1,v.col=-1,$())},e.mouseExited=()=>{v.row=-1,v.col=-1,$()},e.mouseClicked=()=>{if(e.mouseX<0||e.mouseX>e.width||e.mouseY<0||e.mouseY>e.height)return;const n=Math.floor(e.mouseX/c),l=Math.floor(e.mouseY/c);n<0||n>=m||l<0||l>=u||V?.(l,n)}})}let R=null;function p(t,e=2200){const n=document.getElementById("toast");n.textContent=t,n.classList.add("show"),clearTimeout(R),R=setTimeout(()=>n.classList.remove("show"),e)}function be(t){document.getElementById("hdr-notes").textContent=t}function pe(t){document.getElementById("hdr-days").textContent=t}function Ee(t,e=2500){const n=t/e*100;document.getElementById("fill-pct").textContent=n.toFixed(2)+"%",document.getElementById("fill-bar").style.width=n+"%"}function xe({activeCols:t,gridCols:e,compressed:n,durationStr:l,bpm:r}){document.getElementById("active-cols").textContent=`${t} / ${e}`,document.getElementById("compressed-sil").textContent=n,document.getElementById("melody-duration").textContent=l??"—",document.getElementById("tempo-val").textContent=`${r} bpm`}function Ie({total:t,gridSize:e}){document.getElementById("empty-cells").textContent=e-t}const L=[{threshold:.15,name:"Sparse · Airy",desc:"The canvas is nearly empty. Early notes echo in the silence, each one standing alone."},{threshold:.4,name:"Emergent · Rhythmic",desc:"Patterns begin to form. Columns fill, the melody gains a pulse."},{threshold:.7,name:"Dense · Cohesive",desc:"The grid thickens. Harmony emerges from the collective placement."},{threshold:1.01,name:"Full · Ceremonial",desc:"Nearly complete. The canvas approaches its final form. The premiere draws near."}];function Se(t){const e=L.find(n=>t<n.threshold)??L[L.length-1];document.getElementById("phase-name").textContent=e.name,document.getElementById("phase-desc").textContent=e.desc}function we(t){document.getElementById("token-dot").className=`token-dot ${t?"used":"available"}`,document.getElementById("token-text").innerHTML=t?"Note placed today.<br>Come back tomorrow to add another.":"Your note is available today.<br>Click any empty cell."}function Be(t){document.getElementById("deadline-date").textContent=t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function ke(t,e){document.getElementById("playhead-info").innerHTML=`Column <span>${t+1}</span> / 50 · <span>${e}</span>`}function Le(){document.getElementById("playhead-info").textContent="Column — / 50"}function U(t){const e=document.getElementById("btn-play");e.textContent=t?"⏸ Pause":"▶ Play",e.classList.toggle("playing",t)}function Me(t){const e=document.getElementById("color-swatches");e.innerHTML="",g.forEach((n,l)=>{const r=document.createElement("div");r.className="swatch"+(l===0?" active":""),r.dataset.idx=l,r.innerHTML=`
      <div class="swatch-dot" style="background:${n.hex};color:${n.hex}"></div>
      <div class="swatch-info">
        <div class="swatch-name">${n.name}</div>
        <div class="swatch-meta">${re[n.temp]} · ${le[n.bright]}</div>
      </div>`,r.addEventListener("click",()=>{document.querySelectorAll(".swatch").forEach(o=>o.classList.remove("active")),r.classList.add("active"),t(l)}),e.appendChild(r)})}const Te=28,De=new Date(Date.now()-2880*60*1e3);let f=N(),x=0,b=90;F(f,18,g.length);Me(t=>{x=t,K(t)});q(f);K(x);ye(Pe);Ce("canvas-container");de((t,e)=>{ke(t,e)});ue(()=>{U(!1),Le()});document.getElementById("btn-play").addEventListener("click",$e);document.getElementById("btn-stop").addEventListener("click",Re);document.getElementById("btn-clear").addEventListener("click",Ae);document.getElementById("tempo-slider").addEventListener("input",t=>{b=parseInt(t.target.value),document.getElementById("tempo-disp").textContent=b,fe(b),w()});document.getElementById("vol-slider").addEventListener("input",t=>{ge(parseInt(t.target.value))});const z=new Date(De.getTime()+Te*864e5);Be(z);w();function Pe(t,e){if(f[t][e]){p("This cell is already occupied.");return}if(H()){p("You've already placed your note today. Come back tomorrow!");return}f[t][e]={colorIdx:x},te();const n=g[x],l=T(t);he(l,O(n),G(n)),p(`♩ ${l} placed — ${n.name}`),w()}async function $e(){if(se()){S();return}if(!await me(f,b)){p("Place some notes on the grid first!");return}U(!0)}function Re(){S()}function Ae(){confirm("Clear the entire grid? This is irreversible.")&&(f=N(),ne(),S(),F(f,18,g.length),q(f),w(),p("Grid cleared. Demo notes restored."))}function w(){const{total:t,activeCols:e}=oe(f),{events:n,compressed:l}=Y(f),r=m*u,o=t/r,a=X(n,b);let s="—";if(a>=1){const h=Math.floor(a/60),d=Math.floor(a%60).toString().padStart(2,"0");s=`~${h}:${d}`}const i=Math.max(0,Math.ceil((z-Date.now())/864e5));be(t),pe(i),Ee(t,r),xe({activeCols:e,gridCols:m,compressed:l,durationStr:s,bpm:b}),Ie({total:t,gridSize:r}),Se(o),we(H())}
